
[% INCLUDE 'setup/R' %]

[%# ROME Variables, defined by setup/R:
   con 
   rome.userdir
   rome.username  
   rome.experiment_name 

%]

[%# Arguments from Processor
    rome_datafiles_out
    rome_datafiles_in
%]

[%# Arguments from controller 
  selected_outcomes : an array reference
%]


library(affy)
library(gcrma)

outcomes<-c("[%selected_outcomes.join('", "')%]");
obj.names<-load("[% rome_datafiles_in.AB.name %]")
ab<-get(obj.names[1])
eset<-gcrma(ab[,outcomes]);
filename <- "[% rome_datafiles_out.ESet.name %]"
save(eset, file=filename);


