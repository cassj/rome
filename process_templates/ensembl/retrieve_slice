
[% INCLUDE 'setup/Perl' %]

[%# ROME Variables, defined by setup/R:
   $rome_userdir
   $rome_username  
   $rome_experiment_name 

%]

[%# TT Arguments from Processor
    rome_datafiles_out
    rome_datafiles_in
%]

[%# TT Arguments from controller 
  gene_id : an array reference
%]


use Storable qw/nstore/;


#this code will retrieve and return the appropriate ensembl gene
my \$code = sub {
  
  #retreive the code for the registry connection
  require Storable;
  \$Storable::Eval=1;
  my \$registry_code = Storable::retrieve('[% rome_datafiles_in.EnsemblDBRegistry.name %]');
  my \$registry = &\$registry_code; 

  #retrieve a slice adaptor for the requested species
  my \$slice_ad = \$registry->get_adaptor('[%ensembl_species%]','core','slice');
  
  #get the slice
  my \$slice = \$slice_ad->fetch_by_region('chromosome', "[% chr %]", "[% start  %]", "[% end %]");
  
  return \$slice, \$slice_ad, \$registry;
};


#save the gene retrieval code in the appropriate datafile using storable?
\$Storable::Deparse =1;
my \$filename = "[% rome_datafiles_out.SLICE.name %]";
nstore \$code, \$filename;









