\subsubsection{Users}
\label{sec:model_users}

\paragraph{}
Users are represented in the database in the \texttt{person} table. The primary key is the username. As well as self-explanatory fields like \texttt{forename}, \texttt{surname}, \texttt{email}, the \texttt{experiment\_name} and \texttt{experiment\_owner} fields are references to the \texttt{experiment} table and represent the user's currently active experiment. Similarly, a user's currently selected datafiles are held in the \texttt{person\_datafile} table.

\paragraph{}
Authentication (verifying that the user is indeed who they claim to be) is implemented using passwords, stored in the database using one-way (SHA1) encryption. To avoid users having to login every time they make a request, login persistence is implemented using cookies on the client side and sessions on the server side. This process is handled by the Catalyst plugins \texttt{Authentication, Session, Session::Store::FastMmap} and \texttt{Session::State::Cookie} as described further in section \ref{sec:controller_user}. Once a user has been authenticated the relevant DBIx::Class object representing the row of the \texttt{person} table is automatically made available via the Catalyst context as \texttt{\$c->user}.

\paragraph{}
Authorization (verifying that an authenticated user has access rights to a given part of the application) is implemented using roles. Available roles a user may have are stored in the \texttt{role} table and the many-to-many relationship between roles and users is modelled in the \texttt{person\_role} mapping table. Currently the only important roles are \texttt{admin} and \texttt{dev}. For a normal user, ROME controls access such that they cannot edit, or in some cases even view, other user's experiments. Typically a user with the \texttt{admin} role will be allowed to bypass these access controls. There are also various administration pages to which only users with the \texttt{admin} role are granted access. Users with the \texttt{dev} role are granted access to the component development tools in the Devel controller, if installed. Users also have a second layer of authorization that determines their access rights to specific experiments and  datafiles. This is discussed in more detail in the following section.



\paragraph{}
Users have Experiments, which have Datafiles. These are discussed in more detail in sections  \ref{sec:model_experiments} and  \ref{sec:model_datafiles}. Datafiles are stored in the filesystem and only their location is held in the database. 

When a new user is registered, a directory is created under the userdata directory (the location of which is specified in the configuration file). This directory is named with the username in question and has three subdirectories. The scripts directory stores scripts generated for the jobs that user has run. The logs directory stores any output generated by the user's jobs. Finally, the upload directory is the destination for any files that user uploads, as discussed in more detail in sections \ref{sec:controller_upload} and \ref{sec:view_upload}. If a user is deleted, their data directories are also deleted. As shared experiments and datafiles cannot be deleted, a user account cannot be deleted if the user has shared data.

