[% META title="Metadata" %]


[%# If there are no experimental outcomes defined for this experiment then it's 
    meaningles to define metadata  %]

[% IF Catalyst.user.experiment.outcomes < 1 %]
 
  <span class="warning">Not applicable for this experiment - no experimental outcomes defined</span>

[% ELSE %]



[%# First list what we already have defined for this experiment %]

<div id="factors">
<h2>Factors in this experiment</h2>
[%IF Catalyst.user.experiment.factors%]

[% ELSE %]
  <span class="warning">No factors yet defined for this experiment</span>
[% END %]
</div>

<div id="cont_vars">
<h2>Continuous Variables in this experiment</h2>
[%IF Catalyst.user.experiment.cont_vars%]

[% ELSE %]
     <span class="warning">No continuous variables yet defined for this experiment</span>
[% END %]
</div>


<div id="create">

<div id="new_factor">
 [% Catalyst.prototype.link_to_remote( 'Create a Factor', {
      update => 'factor_level_forms',
      url    => "/crud/factor/create_form",
      evalScripts => 'true',
    },{class="ajax_link"} )
 %]

 [% Catalyst.prototype.link_to_remote( 'Create a  Level of a factor', {
      update => 'factor_level_forms',
      url    => "/crud/level/create_form",
      evalScripts=>'true',
    },{class=>"ajax_link"} )
  %]

<div id="factor_level_forms"></div>
</div>


<div id="new_cont_var">
  <div id="cont_var_create_results"></div>
 [% Catalyst.prototype.link_to_remote( 'Create a Continuous Varible', {
      update => 'messages',
      url    => "/crud/cont_var/create_form",
      evalScripts => 'true',
    },{class="ajax_link"} )
 %]

</div>
</div>





[%Catalyst.prototype.form_remote_tag({
     update => 'add_results',
     url    => "/crud/experiment/set_factor"
   } )
%]

  <fieldset> 
     <legend>Add factors to an experiment...</legend>

<div id="add_results"></div>

     <div class="labelled_input">
        <label for="factor_name">Factor Name</label>
        <input type="text" name="factor_name" id="factor_name">
        <div id="factor_name_autocomplete_choices" class="autocomplete"></div>
      </div>

      <input type="hidden" name="factor_owner" id="factor_owner"/>

        <script type="text/javascript" language="javascript">
        // <![CDATA[

             new Ajax.Autocompleter("factor_name",
				    "factor_name_autocomplete_choices",
			            "/crud/factor/autocomplete",
	                            {           
                                     afterUpdateElement :  function () {      
                                                             Ajax.Autocompleter.set_linked_value('factor_owner',
                                                                                                 'factor_owner_update');
                                                            } 
                                   });
        // ]]>
        </script>


       <div class="labelled_input">
        <label for="level_factor_name">Experiment Name</label>
        <input type="text" name="experiment_name" id="experiment_name">
        <div id="experiment_name_autocomplete_choices" class="autocomplete"></div>
      </div>

      <input type="hidden" name="experiment_owner" id="experiment_owner"/>

        <script type="text/javascript" language="javascript">
        // <![CDATA[

             new Ajax.Autocompleter("experiment_name",
				    "experiment_name_autocomplete_choices",
			            "/crud/experiment/autocomplete",
	                            {           
                                     afterUpdateElement :  function () {      
                                                             Ajax.Autocompleter.set_linked_value('experiment_owner',
                                                                                                 'experiment_owner_update');
                                                            } 
                                   });
        // ]]>
        </script>      

       <br/><input type="submit" name="submit" value="Add this factor" class="button"/>

  </fieldset>
</form>


[% END %]

